<html data-arp-injected="true">

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="css/main.css">
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>

  <script>
    function loadAddEndpoint() {
      document.getElementById("newEndpoint").readOnly = false;
      document.getElementById("addEndpoint").innerHTML = "Adding endpoint...";
      setTimeout(() => {
        document.getElementById("addEndpoint").disabled = true;
        document.getElementById("reloadAddEndpoint").style.display = 'block';
        document.getElementById("addEndpoint").innerHTML = "Add endpoint to start";
      }, 2999)
    }
  </script>

  <script>
    function loadCreate() {
      document.getElementById("create").innerHTML = "Creating wallet...";
      setTimeout(() => {
        document.getElementById("create").innerHTML = "Create new";
      }, 2999)
    }
  </script>

  <script>
    function loadAddkey() {
      document.getElementById("newkey").readOnly = false;
      document.getElementById("addkey").innerHTML = "Loading wallet...";
      setTimeout(() => {
        document.getElementById("addkey").disabled = true;
        document.getElementById("reloadAddkey").style.display = 'block';
        document.getElementById("addkey").innerHTML = "Load wallet";
      }, 2999)
    }
  </script>

  <script>
    function loadGetBalance() {
      document.getElementById("getBalance").innerHTML = "Fetching balance...";
      setTimeout(() => {
        document.getElementById("getBalance").innerHTML = "Check balance";
      }, 2999)
    }
  </script>

  <script>
    function loadAddPassword() {
      document.getElementById("newPassword").readOnly = false;
      document.getElementById("addPassword").innerHTML = "Setting password...";
      setTimeout(() => {
        document.getElementById("addPassword").disabled = true;
        document.getElementById("reloadAddPassword").style.display = 'block';
        document.getElementById("addPassword").innerHTML = "Set keystore password";
      }, 2999)
    }
  </script>

  <script>
    function loadEncrypt() {
      document.getElementById("encrypt").innerHTML = "Encrypting keystore...";
      setTimeout(() => {
        document.getElementById("encrypt").innerHTML = "Create keystore";
      }, 2999)
    }
  </script>

  <script>
    function loadDecrypt() {
      document.getElementById("decrypt").innerHTML = "Decrypting keystore...";
      setTimeout(() => {
        document.getElementById("decrypt").innerHTML = "Decrypt keystore";
      }, 2999)
    }
  </script>

  <script>
    function loadAddReceiver() {
      document.getElementById("receiver").readOnly = false;
      document.getElementById("addReceiver").innerHTML = "Estimating costs...";
      setTimeout(() => {
        document.getElementById("addReceiver").disabled = true;
        document.getElementById("reloadEstimate").style.display = 'block';
        document.getElementById("addReceiver").innerHTML = "Estimate costs";
      }, 2999)
    }
  </script>

  <script>
    function loadAddTxReceiver() {
      document.getElementById("txReceiver").readOnly = false;
      document.getElementById("addTxReceiver").innerHTML = "Sending transaction...";
      setTimeout(() => {
        document.getElementById("addTxReceiver").disabled = true;
        document.getElementById("reloadTx").style.display = 'block';
        document.getElementById("addTxReceiver").innerHTML = "Send transaction";
      }, 2999)
    }
  </script>

  <!-- json-first key storage for compatibility -->

  <script>
    function loadEndpoint() {
      fetch('./dls/newendpoint.json')
        .then((response) => response.json())
        .then(function(json) {
          var endpointStr = JSON.stringify(json.endpoint);
          document.getElementById("endpoint").value = endpointStr.slice(1, endpointStr.length - 1);
        }).catch(err => alert(err));
    }
  </script>

  <script>
    function loadPassword() {
      fetch('./dls/newpassword.json')
        .then((response) => response.json())
        .then(function(json) {
          var passStr = JSON.stringify(json.password);
          document.getElementById("password").value = passStr.slice(1, passStr.length - 1);
        }).catch(err => alert(err));
    }
  </script>

  <script>
    function loadAddress() {
      fetch('./dls/keys.json')
        .then((response) => response.json())
        .then(function(json) {
          var addressStr = JSON.stringify(json.address);
          document.getElementById("address").value = addressStr.slice(1, addressStr.length - 1);
        });
    }
  </script>

  <script>
    function loadVitals() {
      fetch('./dls/keys.json')
        .then((response) => response.json())
        .then(function(json) {
          var addressStr = JSON.stringify(json.address);
          document.getElementById("address").value = addressStr.slice(1, addressStr.length - 1);
        });
      fetch('./dls/newendpoint.json')
        .then((response) => response.json())
        .then(function(json) {
          var endpointStr = JSON.stringify(json.endpoint);
          document.getElementById("endpoint").value = endpointStr.slice(1, endpointStr.length - 1);
        });
      fetch('./dls/balance.json')
        .then((response) => response.json())
        .then(function(json) {
          var balanceStr = JSON.stringify(json.ethersBalance);
          document.getElementById("balance").value = balanceStr.slice(1, balanceStr.length - 1);
        });
    }
  </script>

  <script>
    function loadConsole() {
      window.open("https://console.chainstack.com/", "_blank");
    }
  </script>

  <script>
    function loadEndpointTip() {
      document.getElementById("endpoint").value = "Click me to get a free endpoint from chainstack.com"
    }
  </script>

  <script>
    function loadWalletTip() {
      document.getElementById("wallet-label").innerHTML = "Click to copy wallet address"
    }
  </script>

  <script>
    function loadWalletLabel() {
      document.getElementById("wallet-label").innerHTML = "Wallet address"
    }
  </script>

  <script>
    function loadBalanceTip() {
      document.getElementById("balance").value = "Click to show your transaction history on Etherscan"
    }
  </script>

  <script>
    function loadExplorer() {
      window.open("https://etherscan.com/address/" + document.getElementById("address").value, "_blank");
    }
  </script>

  <script>
    function loadWalletCopy() {
      var copyText = document.getElementById("address");
      copyText.select();
      copyText.setSelectionRange(0, 99999);
      navigator.clipboard.writeText(copyText.value);
      alert("Wallet address copied to clipoard: " + copyText.value);
    }
  </script>

</head>
<!-- add triggers and on-click actions  -->

<body onload="loadVitals()">
  <div class="wrapper">
    <h1>BUIDL Y(OUR) O(WN) WALLET</h1>
    <div class="vitals">
      <label class="action-label" style="padding-left: 5px; padding-right:5px"><strong>Node endpoint</strong>
        <input class="vitals-txt" id="endpoint" readonly="true" value="Get a free endpoint on click here or set it below..." onclick="loadConsole()" onmouseover="loadEndpointTip()" onmouseout="loadVitals()"></input>
        </br>
        <label class="action-label" style="padding-left: 5px; padding-right:5px"><strong id="wallet-label">Wallet address</strong>
          <input class="vitals-txt" id="address" readonly="true" value="Create a new wallet or add an existing address..." onclick="loadWalletCopy()" onmouseover="loadWalletTip()" onmouseout="loadWalletLabel()"></input>
        </label>
        </br>
        <label class="action-label" style="padding-left: 5px; padding-right:5px"><strong>Latest balance</strong>
          <input class="vitals-txt" id="balance" readonly="true" value="Load wallet to get balance & send transactions..." onclick="loadExplorer()" onmouseover="loadBalanceTip()" onmouseout="loadVitals()"></input>
        </label>
    </div>
    <div class="actions">

      <div class="action-wrapper" id="endpoint-cat">
        <h2>Manage</h2>
        <label class="action-label"><strong>Access wallets</strong>
          <form action="/pages/balance" method="GET" class="action-form">
            <button id="getBalance" onclick="loadGetBalance()" class="action-btn">Print balance</button>
          </form>
          <form action="/pages/create" method="GET" class="action-form">
            <button id="create" onclick="loadCreate()" class="action-btn">Create new</button>
          </form>
          <form action="/pages/addkey" method="POST" class="action-form">
            <input id="newkey" name="newkey" placeholder="Enter private key" maxlength="66"></input>
            <button id="addkey" onclick="loadAddkey()" class="action-btn">Load wallet</button>
          </form>
          <button id="reloadAddkey" onclick="location.reload()" class="reload-btn">Unlock input</button>
        </label>
        <label class="action-label"><strong>Change endpoint</strong>
          <form action="/pages/addendpoint" method="POST" class="action-form">
            <input id="newEndpoint" name="newEndpoint" placeholder="Enter node endpoint"></input>
            <button id="addEndpoint" onclick="loadAddEndpoint()" class="action-btn">Set endpoint</button>
          </form>
          <button id="reloadAddEndpoint" onclick="location.reload()" class="reload-btn">Unlock input</button>
        </label>
      </div>

      </br>

      <div class="action-wrapper" id="transaction-wrapper">
        <h2>Transact</h2>
        <label class="action-label"><strong>Estimate gas</strong>
          <form action="/pages/estimate" method="POST" class="action-form">
            <input id="receiver" name="receiver" placeholder="Enter receiver address" maxlength="42"></input>
            <button id="addReceiver" onclick="loadAddReceiver()" class="action-btn">Estimate costs</button>
          </form>
          <button id="reloadEstimate" onclick="location.reload()" class="reload-btn">Unlock input</button>
        </label>
        <label class="action-label"><strong>Create transaction</strong>
          <form action="/pages/receipt" method="POST" class="action-form">
            <input id="txReceiver" name="txReceiver" placeholder="Enter receiver address" maxlength="42"></input>
            <input id="txValue" name="txValue" placeholder="Enter amount to send"></input>
            <input id="txData" name="txData" placeholder="Enter tx data (optional)"></input>
            <input id="txGas" name="txGas" placeholder="Enter gas amount"></input>
            <button id="addTxReceiver" onclick="loadAddTxReceiver()" class="action-btn">Send transaction</button>
          </form>
          <button id="reloadTx" onclick="location.reload()" class="reload-btn">Unlock input</button>
        </label>
      </div>

      </br>

      <div class="action-wrapper" id="security-cat">
        <h2>Secure</h2>
        <label class="action-label"><strong>Encrypt keystore</strong>
          <input id="password" readonly="true" placeholder="Click to show password" onclick="loadPassword()"></input>
          <form action="/pages/encrypt" method="GET" class="action-form">
            <button id="encrypt" onclick="loadEncrypt()" class="action-btn">Create keystore</button>
          </form>
          <label class="action-label"><strong>Change password</strong>
            <form action="/pages/addpassword" method="POST" class="action-form">
              <input id="newPassword" name="newPassword" placeholder="Enter keystore pass"></input>
              <button id="addPassword" onclick="loadAddPassword()" class="action-btn">Set password</button>
            </form>
            <button id="reloadAddPassword" onclick="location.reload()" class="reload-btn">Unlock input</button>
          </label>
          <label class="action-label"><strong>Decrypt keystore</strong>
            <input id="keystore" readonly="true" value="./dls/encryptedKeyStore" onclick="loadKeystore()"></input>
            <form action="/pages/decrypt" method="GET" class="action-form">
              <button id="decrypt" onclick="loadDecrypt()" class="action-btn">Decrypt keystore</button>
            </form>
          </label>

      </div>

    </div>
</body>

</html>
